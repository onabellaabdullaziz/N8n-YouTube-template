{"name":"Enterprise YouTube Monetization System","meta":{"createdBy":"onabellaabdullaziz","timestamp":"2025-05-20 21:57:57"},"nodes":[{"parameters":{"rule":{"interval":[{"field":"days","triggerAtHour":9}]}},"id":"a","name":"Schedule","type":"n8n-nodes-base.scheduleTrigger","position":[100,300],"typeVersion":1},{"parameters":{"filePath":"./content-strategy.json"},"id":"b","name":"Content","type":"n8n-nodes-base.readBinaryFile","position":[200,300],"typeVersion":1},{"parameters":{"jsCode":"const d=new Date();const f=`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;const c=JSON.parse(Buffer.from($input.item.binary.data,'base64').toString());const t=c.find(i=>i.publishDate===f);if(!t)return{n:1};function p(k){return k.split(',').length+(k.split(',').some(w=>w.trim().split(' ').length>2)?10:0);}const E={e:\"2025-05-20 21:57:57\",u:\"onabellaabdullaziz\"};return{title:t.title,topic:t.topic,kw:t.keywords,type:t.contentType,aud:t.targetAudience,cta:t.callToAction,promo:t.productPromotion,dur:t.targetDuration||30,ch:t.chapters||[],fmt:t.format||\"s\",lvl:t.accessLevel||\"free\",n:0,id:`c-${Date.now()}`,seo:p(t.keywords),E:E};"},"id":"c","name":"Process","type":"n8n-nodes-base.code","position":[300,300],"typeVersion":1},{"parameters":{"conditions":{"boolean":[{"value1":"={{$json[\"n\"]}}","value2":1}]}},"id":"d","name":"Check","type":"n8n-nodes-base.if","position":[400,300],"typeVersion":1},{"parameters":{"jsCode":"return{s:\"No content scheduled\",date:\"2025-05-20 21:57:57\",user:\"onabellaabdullaziz\"};"},"id":"e","name":"Stop","type":"n8n-nodes-base.code","position":[500,200],"typeVersion":1},{"parameters":{"jsCode":"function pS(t,l){const c={m:[\"monetize\",\"revenue\",\"income\"],g:[\"grow\",\"audience\",\"views\"],p:[\"video\",\"content\",\"camera\"]};let r=\"m\";for(const[k,v]of Object.entries(c))if(v.some(w=>t.toLowerCase().includes(w)))r=k;const m={m:{free:\"brand_deal\",essentials:\"monetize_lab\",professional:\"monetize_pro\",enterprise:\"creator_plus\"},g:{free:\"grow_fast\",essentials:\"audience_pro\",professional:\"creator_sys\",enterprise:\"elite_bundle\"},p:{free:\"thumb_sys\",essentials:\"script_pro\",professional:\"production\",enterprise:\"studio_bundle\"}};return{i:m[r][l]||\"creator_sys\",c:r};}function pD(i){const P={creator_sys:{n:\"Creator System\",p:997,f:[\"Complete system\",\"Pro scripts\",\"Growth algorithm\"],t:\"This transformed my channel. 250K subs in 9 months.\",a:\"Alex Chen, Tech (375K)\"},monetize_pro:{n:\"Monetize Pro\",p:897,f:[\"Revenue streams\",\"Partnership system\",\"Product framework\"],t:\"I quit my job in 90 days. Now making $37K monthly.\",a:\"Sarah Williams, Lifestyle (420K)\"},thumb_sys:{n:\"Thumbnail System\",p:197,f:[\"250+ Templates\",\"Click strategies\",\"A/B testing\"],t:\"CTR increased 64% in one week.\",a:\"Emily Roberts, DIY (180K)\"}};return P[i]||P.creator_sys;}function mT(t){const T={essentials:{n:\"Essentials\",p:\"$29.99/mo\",f:[\"Templates\",\"Community\",\"Newsletter\"]},pro:{n:\"Pro\",p:\"$79.99/mo\",f:[\"AI tools\",\"Coaching\",\"Deals directory\"]},elite:{n:\"Elite\",p:\"$199.99/mo\",f:[\"1:1 coaching\",\"Team tools\",\"Custom development\"]}};return T[t]||T.pro;}const ch=$input.item.json.ch;const ttl=$input.item.json.title;const topic=$input.item.json.topic;const dur=$input.item.json.dur||30;const lvl=$input.item.json.lvl||\"free\";const w=Math.floor(dur*150);const p=pS(topic,lvl);const PD=pD(p.i);const tier=lvl===\"free\"?\"essentials\":lvl===\"essentials\"?\"pro\":\"elite\";const mD=mT(tier);let o=`BRIEF\\nTITLE: \"${ttl}\"\\nTOPIC: ${topic}\\nDUR: ${dur}m (${w}w)\\n\\nSTRUCTURE:\\n`;let cT=0;ch.forEach((h,i)=>{const sM=Math.floor(cT/60);const sS=cT%60;o+=`CH ${i+1}: ${h.title} [${String(sM).padStart(2,'0')}:${String(sS).padStart(2,'0')}] (${h.duration}m)\\n`;if(h.keyPoints){o+=\"Key:\\n\";h.keyPoints.forEach(pt=>o+=`- ${pt}\\n`);}if(i===Math.floor(ch.length/3)){o+=`\\nPRODUCT: Brief mention of ${PD.n}\\n`;}o+=\"\\n\";cT+=(h.duration*60);});o+=`PRODUCT: ${PD.n} ($${PD.p})\\nFEATURES:\\n`;PD.f.forEach(f=>o+=`- ${f}\\n`);o+=`\\nMEMBERSHIP: ${mD.n} (${mD.p})\\nFEATURES:\\n`;mD.f.forEach(f=>o+=`- ${f}\\n`);o+=`\\nTESTIMONIAL: \"${PD.t}\" - ${PD.a}`;return{brief:o,title:ttl,topic,dur,w,id:$input.item.json.id,lvl,prod:{i:p.i,c:p.c,d:PD,m:{t:tier,d:mD}},E:$input.item.json.E};"},"id":"f","name":"Strategy","type":"n8n-nodes-base.code","position":[500,400],"typeVersion":1},{"parameters":{"method":"POST","url":"http://llama:8080/completion","sendBody":true,"contentType":"json","bodyParameters":{"parameters":[{"name":"prompt","value":"=You are a professional scriptwriter. Create a script based on this brief:\\n\\n{{$node[\"Strategy\"].json.brief}}\\n\\nRequirements:\\n1. Include timestamps [00:00] for each section\\n2. Promote the product naturally at specified points\\n3. End with strong call to action\\n4. Write ~{{$node[\"Strategy\"].json.w}} words\\n5. Make it professional and engaging"},{"name":"max_tokens","value":4000},{"name":"temperature","value":0.7}]}},"id":"g","name":"Script","type":"n8n-nodes-base.httpRequest","position":[600,400],"typeVersion":3},{"parameters":{"jsCode":"const r=$input.item.json;let s='';if(r.content)s=r.content;else if(r.response)s=r.response;else if(r.output)s=r.output;else if(r.completion)s=r.completion;else s=JSON.stringify(r);const x=/\\[(\\d{2}):(\\d{2})\\]/g;const S=[];let l=0;let m;let C='00:00';let T='';while((m=x.exec(s))!==null){if(l>0){S.push({t:C,n:T||'Section',c:s.substring(l,m.index).trim()});}C=`${m[1]}:${m[2]}`;const e=s.indexOf('\\n',m.index);T=e>-1?s.substring(m.index+m[0].length,e).trim():'Section';l=e>-1?e:m.index+m[0].length;}if(l<s.length){S.push({t:C,n:'Conclusion',c:s.substring(l).trim()});}const P=s.replace(/\\[\\d{2}:\\d{2}\\]/g,'').replace(/\\n+/g,' ').trim();let F=`# ${$node[\"Strategy\"].json.title}\\n\\n`;F+=`**Duration:** ${$node[\"Strategy\"].json.dur} minutes\\n\\n`;F+=`## SCRIPT\\n\\n`;S.forEach(sc=>{F+=`### [${sc.t}] ${sc.n}\\n\\n${sc.c}\\n\\n`;});const Pr=s.match(new RegExp($node[\"Strategy\"].json.prod.d.n,'g'))||[];return{fullScript:s,formattedScript:F,sections:S,plainText:P,productMentions:Pr.length,id:$node[\"Strategy\"].json.id,title:$node[\"Strategy\"].json.title,dur:$node[\"Strategy\"].json.dur,lvl:$node[\"Strategy\"].json.lvl,prod:$node[\"Strategy\"].json.prod,E:$node[\"Strategy\"].json.E};"},"id":"h","name":"Format","type":"n8n-nodes-base.code","position":[700,400],"typeVersion":1},{"parameters":{"method":"POST","url":"http://stable-diffusion:7860/sdapi/v1/txt2img","sendBody":true,"contentType":"json","bodyParameters":{"parameters":[{"name":"prompt","value":"=professional YouTube thumbnail for \"{{$node[\"Format\"].json.title}}\", high-end photography, 4K, professional lighting, striking composition, {{$node[\"Format\"].json.dur}} minute video indicator, related to {{$node[\"Format\"].json.prod.c}}"},{"name":"negative_prompt","value":"text, words, low quality, amateur, blurry"},{"name":"width","value":1280},{"name":"height","value":720},{"name":"steps","value":40}]}},"id":"i","name":"Thumb","type":"n8n-nodes-base.httpRequest","position":[800,300],"typeVersion":3},{"parameters":{"method":"POST","url":"http://stable-diffusion:7860/sdapi/v1/txt2img","sendBody":true,"contentType":"json","bodyParameters":{"parameters":[{"name":"prompt","value":"=alternate YouTube thumbnail for \"{{$node[\"Format\"].json.title}}\", different style, dramatic lighting, bold colors, professional, {{$node[\"Format\"].json.dur}} minute indicator, A/B testing variant"},{"name":"negative_prompt","value":"text, words, low quality, amateur, blurry"},{"name":"width","value":1280},{"name":"height","value":720},{"name":"steps","value":40}]}},"id":"ia","name":"AltThumb","type":"n8n-nodes-base.httpRequest","position":[800,200],"typeVersion":3},{"parameters":{"jsCode":"const r=$node[\"Thumb\"].json;const ra=$node[\"AltThumb\"].json;let I='';let Ia='';if(r.images&&r.images.length>0)I=r.images[0];else if(r.output)I=r.output[0];if(ra.images&&ra.images.length>0)Ia=ra.images[0];else if(ra.output)Ia=ra.output[0];const t=Date.now();const F=`thumb_${$node[\"Format\"].json.id}_${t}.png`;const Fa=`thumb_alt_${$node[\"Format\"].json.id}_${t}.png`;const Ab={id:`test_${$node[\"Format\"].json.id}`,dist:{p:0.7,a:0.3},track:\"?v={{variant}}\"};return{img:I,file:F,imgA:Ia,fileA:Fa,ab:Ab};"},"id":"j","name":"ImgProcess","type":"n8n-nodes-base.code","position":[900,300],"typeVersion":1},{"parameters":{"bucketName":"youtube-assets","fileName":"={{$json[\"file\"]}}","fileContent":"={{$json[\"img\"]}}"},"id":"k","name":"UploadImg","type":"n8n-nodes-base.s3","position":[1000,250],"typeVersion":1,"credentials":{"s3":{"id":"minio","name":"MinIO"}}},{"parameters":{"bucketName":"youtube-assets","fileName":"={{$json[\"fileA\"]}}","fileContent":"={{$json[\"imgA\"]}}"},"id":"ka","name":"UploadImgAlt","type":"n8n-nodes-base.s3","position":[1000,350],"typeVersion":1,"credentials":{"s3":{"id":"minio","name":"MinIO"}}},{"parameters":{"jsCode":"const P=$node[\"Format\"].json.plainText;const S=$node[\"Format\"].json.sections;const Z=4000;const K=[];let C='';for(const s of S){if(C.length+s.c.length>Z&&C.length>0){K.push({x:C.trim(),s:s.n});C='';}if(s.c.length>Z){if(C.length>0){K.push({x:C.trim(),s:s.n});C='';}const N=s.c.match(/[^.!?]+[.!?]+/g)||[s.c];for(const n of N){if(C.length+n.length>Z){K.push({x:C.trim(),s:s.n});C='';}C+=n+' ';}}else{C+=`${s.c} `;}}if(C.length>0)K.push({x:C.trim(),s:S[S.length-1].n});const Pr=$node[\"Format\"].json.prod.c;const V={m:\"en_US-lessac-medium\",g:\"en_US-amy-medium\",p:\"en_UK-alan-medium\"};return{chunks:K,count:K.length,title:$node[\"Format\"].json.title,dur:$node[\"Format\"].json.dur,id:$node[\"Format\"].json.id,voice:V[Pr]||V.m};"},"id":"l","name":"AudioPrep","type":"n8n-nodes-base.code","position":[800,500],"typeVersion":1},{"parameters":{"batchSize":1,"options":{}},"id":"m","name":"Chunks","type":"n8n-nodes-base.splitInBatches","position":[900,500],"typeVersion":2},{"parameters":{"functionField":"={{$json[\"chunks\"][$json[\"batchIndex\"]-1][\"x\"]}}","options":{}},"id":"n","name":"Extract","type":"n8n-nodes-base.function","position":[1000,500],"typeVersion":1},{"parameters":{"method":"POST","url":"http://piper:5000/api/tts","sendBody":true,"contentType":"json","bodyParameters":{"parameters":[{"name":"text","value":"={{$json[\"functionResult\"]}}"},{"name":"speaker","value":"={{$node[\"AudioPrep\"].json[\"voice\"]}}"},{"name":"output_format","value":"wav"}]}},"id":"o","name":"TTS","type":"n8n-nodes-base.httpRequest","position":[1100,500],"typeVersion":3},{"parameters":{"jsCode":"const i=$input.item.json.batchIndex;const t=Date.now();const F=`audio_${$node[\"AudioPrep\"].json.id}_${i}_${t}.wav`;let A='';if($input.item.json.audio_base64)A=$input.item.json.audio_base64;else if($input.item.json.audio)A=$input.item.json.audio;else if($input.item.json.data)A=$input.item.json.data;return{audio:A,file:F,index:i,last:$input.item.json.lastBatch};"},"id":"p","name":"AudioProcess","type":"n8n-nodes-base.code","position":[1200,500],"typeVersion":1},{"parameters":{"bucketName":"youtube-assets","fileName":"={{$json[\"file\"]}}","fileContent":"={{$json[\"audio\"]}}"},"id":"q","name":"UploadAudio","type":"n8n-nodes-base.s3","position":[1300,500],"typeVersion":1,"credentials":{"s3":{"id":"minio","name":"MinIO"}}},{"parameters":{"conditions":{"boolean":[{"value1":"={{$json[\"last\"]}}","value2":true}]}},"id":"r","name":"Last?","type":"n8n-nodes-base.if","position":[1400,500],"typeVersion":1},{"parameters":{"jsCode":"// Determine avatar style based on content category\nconst contentCategory = $node[\"Format\"].json.prod.c;\nconst contentLevel = $node[\"Format\"].json.lvl;\n\n// Map content categories to avatar styles\nconst avatarStyles = {\n  m: \"business\",    // Monetization content = Business professional\n  g: \"casual\",      // Growth content = Casual professional\n  p: \"creative\"     // Production content = Creative professional\n};\n\n// Map content levels to avatar quality\nconst avatarQualities = {\n  free: \"standard\",\n  essentials: \"premium\",\n  professional: \"enterprise\",\n  enterprise: \"cinema\"\n};\n\n// Select appropriate avatars for this content\nconst style = avatarStyles[contentCategory] || \"business\";\nconst quality = avatarQualities[contentLevel] || \"premium\";\n\n// Avatar models appropriate for the content\nconst avatarModels = {\n  business: [\"marcus_pro\", \"sophia_exec\", \"james_finance\"],\n  casual: [\"alex_friendly\", \"taylor_approachable\", \"jamie_relatable\"],\n  creative: [\"zoe_artistic\", \"leo_creative\", \"robin_innovative\"]\n};\n\n// Select primary avatar based on content\nconst primaryAvatar = avatarModels[style][0];\n\n// Prepare avatar generation request\nreturn {\n  avatar: primaryAvatar,\n  avatarStyle: style,\n  avatarQuality: quality,\n  contentId: $node[\"Format\"].json.id,\n  script: $node[\"Format\"].json.plainText,\n  sections: $node[\"Format\"].json.sections,\n  productName: $node[\"Format\"].json.prod.d.n,\n  title: $node[\"Format\"].json.title,\n  created: \"2025-05-20 21:57:57\",\n  creator: \"onabellaabdullaziz\"\n};"},"id":"av1","name":"AvatarSelector","type":"n8n-nodes-base.code","position":[800,600],"typeVersion":1},{"parameters":{"method":"POST","url":"http://avatarapi:8090/v1/generate","sendBody":true,"contentType":"json","bodyParameters":{"parameters":[{"name":"model","value":"={{$json[\"avatar\"]}}"},{"name":"script","value":"={{$json[\"script\"]}}"},{"name":"quality","value":"={{$json[\"avatarQuality\"]}}"},{"name":"resolution","value":"1080p"},{"name":"background","value":"professional_gradient"}]}},"id":"av2","name":"GenerateAvatar","type":"n8n-nodes-base.httpRequest","position":[900,600],"typeVersion":3},{"parameters":{"jsCode":"// Process avatar generation result\nconst response = $input.item.json;\nlet videoUrl = '';\nlet thumbnailUrl = '';\n\nif (response.status === 'success') {\n  videoUrl = response.video_url;\n  thumbnailUrl = response.thumbnail_url;\n} else {\n  // Handle error case\n  videoUrl = 'ERROR';\n  thumbnailUrl = 'ERROR';\n}\n\nconst now = Date.now();\nconst filename = `avatar_${$node[\"AvatarSelector\"].json.contentId}_${now}.mp4`;\n\nreturn {\n  avatarVideoUrl: videoUrl,\n  avatarThumbnailUrl: thumbnailUrl,\n  avatarModel: $node[\"AvatarSelector\"].json.avatar,\n  avatarStyle: $node[\"AvatarSelector\"].json.avatarStyle,\n  avatarQuality: $node[\"AvatarSelector\"].json.avatarQuality,\n  avatarFilename: filename,\n  contentId: $node[\"AvatarSelector\"].json.contentId\n};"},"id":"av3","name":"ProcessAvatar","type":"n8n-nodes-base.code","position":[1000,600],"typeVersion":1},{"parameters":{"bucketName":"youtube-assets","fileName":"={{$json[\"avatarFilename\"]}}","fileContent":"={{$json[\"avatarVideoUrl\"]}}"},"id":"av4","name":"UploadAvatar","type":"n8n-nodes-base.s3","position":[1100,600],"typeVersion":1,"credentials":{"s3":{"id":"minio","name":"MinIO"}}},{"parameters":{"jsCode":"const I=$input.all();\nconst A=[];\nconst T=$node[\"UploadImg\"].json.path;\nconst Ta=$node[\"UploadImgAlt\"].json.path;\nconst V=$node[\"UploadAvatar\"].json.path;  // Add avatar path\n\nI.forEach(i=>{\n  if(i.json.file&&i.json.file.startsWith('audio_'))A.push(i.json.path);\n});\n\nconst url='https://your-cdn.com';\nconst B='youtube-assets';\nconst AU=A.map(a=>`${url}/${B}/${a}`);\nconst TU=`${url}/${B}/${T}`;\nconst TUa=`${url}/${B}/${Ta}`;\nconst VU=`${url}/${B}/${V}`;  // Avatar video URL\n\nconst PD=$node[\"Format\"].json.prod.d;\nconst MD=$node[\"Format\"].json.prod.m.d;\n\nreturn{\n  title:$node[\"Format\"].json.title,\n  script:$node[\"Format\"].json.formattedScript,\n  thumbUrl:TU,\n  thumbUrlAlt:TUa,\n  audioUrls:AU,\n  avatarUrl:VU,  // Add avatar URL\n  avatarModel:$node[\"ProcessAvatar\"].json.avatarModel,  // Add avatar model info\n  avatarStyle:$node[\"ProcessAvatar\"].json.avatarStyle,\n  avatarQuality:$node[\"ProcessAvatar\"].json.avatarQuality,\n  id:$node[\"Format\"].json.id,\n  dur:$node[\"Format\"].json.dur,\n  lvl:$node[\"Format\"].json.lvl,\n  ab:$node[\"ImgProcess\"].json.ab,\n  prod:{id:$node[\"Format\"].json.prod.i,name:PD.n,price:PD.p,features:PD.f,test:PD.t,auth:PD.a,tier:$node[\"Format\"].json.prod.m.t,mName:MD.n,mPrice:MD.p,mFeatures:MD.f},\n  created:\"2025-05-20 21:57:57\",\n  creator:\"onabellaabdullaziz\"\n};"},"id":"s","name":"Collect","type":"n8n-nodes-base.code","position":[1500,400],"typeVersion":1},{"parameters":{"jsCode":"const c=require('crypto');const d=new Date();const e=Math.floor(d.valueOf()/1000)+5*60;const k='YOUR_GHOST_API_KEY';const[i,s]=k.split(':');const m=Buffer.from(JSON.stringify({exp:e}));const g=c.createHmac('sha256',Buffer.from(s,'hex')).update(m).digest('hex');const t=`${i}:${g}`;return{token:t};"},"id":"t","name":"Token","type":"n8n-nodes-base.code","position":[1600,400],"typeVersion":1},{"parameters":{"jsCode":"const t=$input.item.json.title;\nconst s=$input.item.json.script;\nconst Tu=$input.item.json.thumbUrl;\nconst Tua=$input.item.json.thumbUrlAlt;\nconst Au=$input.item.json.audioUrls;\nconst i=$input.item.json.id;\nconst P=$input.item.json.prod;\nconst Ab=$input.item.json.ab;\n\n// Add avatar video to the content\nconst Av = $input.item.json.avatarUrl ? \n  `<div class=\"avatar-container\">\n    <h3>Watch Video Presentation</h3>\n    <video controls poster=\"${Tu}\" width=\"100%\">\n      <source src=\"${$input.item.json.avatarUrl}\" type=\"video/mp4\">\n      Your browser does not support the video tag.\n    </video>\n    <p class=\"avatar-info\">Presented by virtual assistant using ${$input.item.json.avatarModel} (${$input.item.json.avatarStyle} style, ${$input.item.json.avatarQuality} quality)</p>\n  </div>` : '';\n\nlet Ap='';\nif(Au.length===1){\n  Ap=`<figure class=\"audio\"><audio controls src=\"${Au[0]}\"></audio></figure>`;\n}else{\n  Ap=`<div class=\"player\"><audio id=\"p-${i}\" controls><source src=\"${Au[0]}\"></audio><div class=\"list\"><h4>Segments</h4><ul>`;\n  Au.forEach((u,j)=>{\n    Ap+=`<li><button onclick=\"document.getElementById('p-${i}').src='${u}';document.getElementById('p-${i}').play();\">Part ${j+1}</button></li>`;\n  });\n  Ap+=`</ul></div></div>`;\n}\n\nconst Ps=`<div class=\"product\"><h3>${P.name}</h3><div class=\"price\">$${P.price}</div><ul>${P.features.map(f=>`<li>${f}</li>`).join('')}</ul><div class=\"test\"><p>\"${P.test}\"</p><div class=\"author\">${P.auth}</div></div><a href=\"/products/${P.id}?src=${i}&${Ab.track.replace('{{variant}}','a')}\" class=\"cta\">Get Started</a></div>`;\nconst Ms=`<div class=\"member\"><h3>${P.mName}</h3><div class=\"price\">${P.mPrice}</div><ul>${P.mFeatures.map(f=>`<li>${f}</li>`).join('')}</ul><a href=\"/join/${P.tier}?src=${i}\" class=\"join\">Join Now</a></div>`;\n\nconst Ht=`<style>.product,.member{padding:30px;border-radius:8px;margin:30px 0}.product{background:#f5f7fa}.price{font-weight:bold;font-size:24px;margin:10px 0}.member{background:#2c3e50;color:white}.cta,.join{display:inline-block;background:#e74c3c;color:white;padding:15px 30px;border-radius:5px;text-decoration:none;margin-top:15px}.join{background:white;color:#2c3e50}.player{background:#f0f2f5;padding:20px;border-radius:8px;margin:20px 0}.avatar-container{margin:30px 0;background:#f0f2f5;padding:20px;border-radius:8px}.avatar-info{font-style:italic;font-size:0.8em;text-align:right}.list ul{list-style:none;padding:0}.list button{width:100%;padding:10px;margin:5px 0;background:#fff;border:1px solid #ddd;border-radius:4px;text-align:left;cursor:pointer}.test{background:white;padding:15px;border-radius:5px;margin:15px 0;font-style:italic}.author{font-weight:bold;margin-top:10px}</style><figure><img src=\"${Math.random()<Ab.dist.p?Tu:Tua}\" alt=\"${t}\" data-test-id=\"${Ab.id}\" data-variant=\"${Math.random()<Ab.dist.p?'p':'a'}\"></figure>${Ap}${Av}<h2>Full Transcript</h2>${s.replace(/\\n/g,'<br>')}${Ps}${Ms}<script type=\"application/ld+json\">{\"@context\":\"https://schema.org\",\"@type\":\"Article\",\"headline\":\"${t}\",\"image\":\"${Tu}\",\"video\":\"${$input.item.json.avatarUrl || ''}\",\"author\":{\"@type\":\"Person\",\"name\":\"${$input.item.json.creator}\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Professional Content\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https://your-domain.com/logo.png\"}},\"datePublished\":\"${$input.item.json.created}\",\"description\":\"Professional ${$input.item.json.dur}-minute guide to ${t}\"}</script>`;\n\nreturn{title:`${t} | ${$input.item.json.dur}-Min Guide`,html:Ht};"},"id":"u","name":"Format","type":"n8n-nodes-base.code","position":[1700,400],"typeVersion":1},{"parameters":{"method":"POST","url":"http://ghost:2368/ghost/api/v3/admin/posts/","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Ghost {{$node[\"Token\"].json[\"token\"]}}"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"contentType":"json","bodyParameters":{"parameters":[{"name":"posts","value":"=[{\"title\":\"{{$node[\"Format\"].json[\"title\"]}}\",\"html\":{{$json[\"html\"]}},\"status\":\"published\",\"visibility\":\"{{$node[\"Collect\"].json[\"lvl\"]}}\",\"tags\":[{\"name\":\"premium\"},{\"name\":\"youtube\"}],\"featured\":true,\"meta_title\":\"{{$node[\"Format\"].json[\"title\"]}}\",\"meta_description\":\"Professional {{$node[\"Collect\"].json[\"dur\"]}}-minute guide to {{$node[\"Collect\"].json[\"title\"]}}\",\"codeinjection_head\":\"<meta property=\\\"og:audio\\\" content=\\\"{{$node[\"Collect\"].json[\"audioUrls\"][0]}}\\\">\\n<meta property=\\\"og:video\\\" content=\\\"{{$node[\"Collect\"].json[\"avatarUrl\"]}}\\\"\\n<meta property=\\\"og:type\\\" content=\\\"article\\\">\\n<meta property=\\\"og:article:published_time\\\" content=\\\"{{$node[\"Collect\"].json[\"created\"]}}\\\">\\n<meta property=\\\"og:article:author\\\" content=\\\"{{$node[\"Collect\"].json[\"creator\"]}}\\\">\\n<meta property=\\\"og:article:tag\\\" content=\\\"{{$node[\"Collect\"].json[\"prod\"][\"name\"]}}\\\">\\n<meta name=\\\"thumbnail\\\" content=\\\"{{$node[\"Collect\"].json[\"thumbUrl\"]}}\\\">\\n<meta name=\\\"generator\\\" content=\\\"Enterprise Content System {{$node[\"Collect\"].json[\"id\"]}}\\\">\"}]"}]}},"id":"v","name":"Publish","type":"n8n-nodes-base.httpRequest","position":[1800,400],"typeVersion":3},{"parameters":{"method":"POST","url":"http://mautic:80/api/emails/new","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","sendBody":true,"contentType":"json","bodyParameters":{"parameters":[{"name":"name","value":"=New: {{$node[\"Format\"].json[\"title\"]}}"},{"name":"subject","value":"=New Guide: {{$node[\"Collect\"].json[\"title\"]}} | {{$node[\"Collect\"].json[\"dur\"]}} mins"},{"name":"customHtml","value":"=<html><body><h1>New Premium Content</h1><p>We've published a new {{$node[\"Collect\"].json[\"dur\"]}}-minute guide with video avatar presentation.</p><p><strong>{{$node[\"Collect\"].json[\"title\"]}}</strong></p><p>This guide comes with our <strong>{{$node[\"Collect\"].json[\"prod\"][\"name\"]}}</strong> recommendation and features our <strong>{{$node[\"Collect\"].json[\"avatarModel\"]}}</strong> digital presenter.</p><a href=\"{webview_url}\" style=\"display:inline-block;background:#e74c3c;color:white;padding:10px 20px;text-decoration:none;border-radius:5px\">Watch Now</a><p>Created: {{$node[\"Collect\"].json[\"created\"]}} by {{$node[\"Collect\"].json[\"creator\"]}}</p><p><a href=\"{unsubscribe_url}\">Unsubscribe</a></p></body></html>"},{"name":"emailType","value":"template"},{"name":"segmentId","value":1}]}},"id":"w","name":"Email","type":"n8n-nodes-base.httpRequest","position":[1900,350],"typeVersion":3,"credentials":{"httpBasicAuth":{"id":"mautic","name":"Mautic"}}},{"parameters":{"method":"POST","url":"http://plausible:8000/api/event","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"contentType":"json","bodyParameters":{"parameters":[{"name":"name","value":"publish"},{"name":"domain","value":"your-domain.com"},{"name":"url","value":"=https://your-domain.com/{{$node[\"Publish\"].json.slug}}"},{"name":"props","value":"={\"id\":\"{{$node[\"Collect\"].json.id}}\",\"title\":\"{{$node[\"Collect\"].json.title}}\",\"level\":\"{{$node[\"Collect\"].json.lvl}}\",\"product\":\"{{$node[\"Collect\"].json.prod.name}}\",\"avatar\":\"{{$node[\"Collect\"].json.avatarModel}}\",\"avatarStyle\":\"{{$node[\"Collect\"].json.avatarStyle}}\",\"abTest\":\"{{$node[\"Collect\"].json.ab.id}}\",\"meta\":{\"date\":\"{{$node[\"Collect\"].json.created}}\",\"user\":\"{{$node[\"Collect\"].json.creator}}\"}}"}]}},"id":"x","name":"Analytics","type":"n8n-nodes-base.httpRequest","position":[1900,450],"typeVersion":3},{"parameters":{"jsCode":"return{\n  status:\"success\",\n  title:$node[\"Collect\"].json.title,\n  url:`https://your-domain.com/${$node[\"Publish\"].json.slug}`,\n  product:$node[\"Collect\"].json.prod.name,\n  membership:$node[\"Collect\"].json.prod.mName,\n  avatar:$node[\"Collect\"].json.avatarModel,\n  avatarStyle:$node[\"Collect\"].json.avatarStyle,\n  created:$node[\"Collect\"].json.created,\n  creator:$node[\"Collect\"].json.creator,\n  performance:{\n    audioChunks:$node[\"Collect\"].json.audioUrls.length,\n    thumbnailVariants:2,\n    avatarQuality:$node[\"Collect\"].json.avatarQuality,\n    abTestId:$node[\"Collect\"].json.ab.id\n  }\n};"},"id":"y","name":"Success","type":"n8n-nodes-base.code","position":[2000,400],"typeVersion":1}],"connections":{"a":{"main":[[{"node":"b","type":"main","index":0}]]},"b":{"main":[[{"node":"c","type":"main","index":0}]]},"c":{"main":[[{"node":"d","type":"main","index":0}]]},"d":{"main":[[{"node":"e","type":"main","index":0}],[{"node":"f","type":"main","index":0}]]},"f":{"main":[[{"node":"g","type":"main","index":0}]]},"g":{"main":[[{"node":"h","type":"main","index":0}]]},"h":{"main":[[{"node":"i","type":"main","index":0},{"node":"ia","type":"main","index":0},{"node":"l","type":"main","index":0},{"node":"av1","type":"main","index":0}]]},"i":{"main":[[{"node":"j","type":"main","index":0}]]},"ia":{"main":[[{"node":"j","type":"main","index":0}]]},"j":{"main":[[{"node":"k","type":"main","index":0},{"node":"ka","type":"main","index":0}]]},"l":{"main":[[{"node":"m","type":"main","index":0}]]},"m":{"main":[[{"node":"n","type":"main","index":0}]]},"n":{"main":[[{"node":"o","type":"main","index":0}]]},"o":{"main":[[{"node":"p","type":"main","index":0}]]},"p":{"main":[[{"node":"q","type":"main","index":0}]]},"q":{"main":[[{"node":"r","type":"main","index":0}]]},"r":{"main":[[{"node":"s","type":"main","index":0}],[{"node":"m","type":"main","index":0}]]},"k":{"main":[[{"node":"s","type":"main","index":0}]]},"ka":{"main":[[{"node":"s","type":"main","index":0}]]},"av1":{"main":[[{"node":"av2","type":"main","index":0}]]},"av2":{"main":[[{"node":"av3","type":"main","index":0}]]},"av3":{"main":[[{"node":"av4","type":"main","index":0}]]},"av4":{"main":[[{"node":"s","type":"main","index":0}]]},"s":{"main":[[{"node":"t","type":"main","index":0}]]},"t":{"main":[[{"node":"u","type":"main","index":0}]]},"u":{"main":[[{"node":"v","type":"main","index":0}]]},"v":{"main":[[{"node":"w","type":"main","index":0},{"node":"x","type":"main","index":0},{"node":"y","type":"main","index":0}]]}}}